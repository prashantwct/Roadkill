{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-6">
    <div class="card shadow-sm p-4">
      <h3>Edit Sample {{ s.label }}</h3>
      <form method="POST">
        
        <div class="mb-3">
          <label class="form-label">Sample Type</label>
          <select name="sample_type_select" id="sampleTypeSelect" class="form-select" onchange="checkSampleTypeOther()" required>
            <option value="">Select type...</option>
            {% for opt in ['Nasal Swab', 'Oral Swab', 'Rectal Swab', 'Brain Swab', 'Brain Tissue', 'Lung Tissue', 'Liver Tissue', 'Urinary Bladder Swab', 'Urinary Bladder Tissue', 'Other'] %}
              <option value="{{ opt }}">{{ opt }}</option>
            {% endfor %}
          </select>

          <div id="sampleTypeCustomDiv" class="mt-2" style="display:none;">
            <input name="sample_type_custom" id="sampleTypeCustomInput" class="form-control" placeholder="Specify sample type...">
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Storage</label>
          <input name="storage" class="form-control" value="{{ s.storage }}">
        </div>
        <div class="mb-3">
          <label class="form-label">Notes</label>
          <textarea name="notes" class="form-control" rows="3">{{ s.notes }}</textarea>
        </div>
        <button class="btn btn-success w-100">Update Sample</button>
        <a href="{{ url_for('view_sample', sample_id=s.id) }}" class="btn btn-link w-100 mt-2">Cancel</a>
      </form>
    </div>
  </div>
</div>

<script>
function checkSampleTypeOther() {
  const select = document.getElementById('sampleTypeSelect');
  const customDiv = document.getElementById('sampleTypeCustomDiv');
  const customInput = document.getElementById('sampleTypeCustomInput');

  if (select.value === 'Other') {
    customDiv.style.display = 'block';
    customInput.required = true;
  } else {
    customDiv.style.display = 'none';
    customInput.required = false;
  }
}

document.addEventListener("DOMContentLoaded", function() {
  const savedType = "{{ s.sample_type }}";
  const select = document.getElementById('sampleTypeSelect');
  const customInput = document.getElementById('sampleTypeCustomInput');

  let found = false;
  for(let i=0; i<select.options.length; i++){
    if(select.options[i].value === savedType){
      select.selectedIndex = i;
      found = true;
      break;
    }
  }

  // If the saved type isn't in the list (and isn't empty), it's a custom 'Other'
  if(!found && savedType && savedType !== 'None') {
    select.value = 'Other';
    checkSampleTypeOther();
    customInput.value = savedType;
  }
});
</script>
{% endblock %}
